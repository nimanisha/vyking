replicaCount: 2

image:
  repository: nginx
  tag: alpine

service:
  type: ClusterIP
  port: 80
serviceAccount:
  create: true
  name: "frontend-service-account"  

backendUrl: "http://backend-service.backend.svc.cluster.local:8080/api/"

hpa:
  minReplicas: 1
  maxReplicas: 2
  targetCPU: 80
ingress:
  enabled: true
  className: "traefik"
  host: "frontend.k3d.localhost" 
  path: /
indexHtml: |
  <!DOCTYPE html>
  <html>
  <head>
      <title>User Rating System</title>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  </head>
  <body class="container mt-5">
      <h2>Register rate of Users</h2>
      <form id="rateForm" class="mb-4">
          <input type="text" id="name" placeholder="Name" class="form-control mb-2" required>
          <input type="text" id="surname" placeholder="Surname" class="form-control mb-2" required>
          <input type="number" id="rate" placeholder="Rate (1-10)" class="form-control mb-2" required>
          <button type="submit" class="btn btn-primary">Register Rate</button>
      </form>

      <hr>
      <h3>List of Rates</h3>
      <table class="table">
          <thead>
              <tr>
                  <th>Name</th>
                  <th>Surname</th>
                  <th>Rate</th>
              </tr>
          </thead>
          <tbody id="userTableBody"></tbody>
      </table>

      <script>
          // تغییر اصلی اینجاست: استفاده از مسیر نسبی برای فعال شدن پروکسی Nginx
          const API_URL = '/api/users'; 

          async function fetchUsers() {
              try {
                  const response = await fetch(API_URL);
                  const users = await response.json();
                  const tableBody = document.getElementById('userTableBody');
                  tableBody.innerHTML = '';
                  users.forEach(user => {
                      tableBody.innerHTML += `
                          <tr>
                              <td>${user.name}</td>
                              <td>${user.surname}</td>
                              <td>${user.rate}</td>
                          </tr>`;
                  });
              } catch (error) {
                  console.error('Error fetching users:', error);
              }
          }

          document.getElementById('rateForm').addEventListener('submit', async (e) => {
              e.preventDefault();
              const userData = {
                  name: document.getElementById('name').value,
                  surname: document.getElementById('surname').value,
                  rate: document.getElementById('rate').value
              };

              try {
                  await fetch(API_URL, {
                      method: 'POST',
                      headers: { 'Content-Type': 'application/json' },
                      body: JSON.stringify(userData)
                  });
                  fetchUsers();
                  e.target.reset();
              } catch (error) {
                  console.error('Error submitting rate:', error);
              }
          });

          fetchUsers();
      </script>
  </body>
  </html>